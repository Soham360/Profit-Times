<div id="profit-times-ticker-container"></div>

<style>
/* Bar wrapper */
#profit-times-ticker-container {
  background: #f8f9fa;
  border-bottom: 1px solid #e6e6e6;
  overflow: hidden;
  white-space: nowrap;
  width: 100%;
  box-sizing: border-box;
  position: relative;
  padding: 8px 0;
  z-index: 1000;
}

/* Scrolling content container */
#profit-times-ticker-track {
  display: inline-flex;
  white-space: nowrap;
  gap: 40px;
  align-items: center;
  will-change: transform;
}

/* Headline links */
#profit-times-ticker-track a {
  color: #0d6efd;
  text-decoration: none;
  font-weight: 600;
}

/* "Latest:" label */
#profit-times-ticker-track .label {
  font-weight: 700;
  color: #333;
  margin-right: 20px;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {

  /* -----------------------------
     1. Insert ticker at top of body
  ----------------------------- */
  const container = document.getElementById("profit-times-ticker-container");
  document.body.insertBefore(container, document.body.firstChild);

  /* Create the scrolling track */
  const track = document.createElement("div");
  track.id = "profit-times-ticker-track";
  container.appendChild(track);

  /* Add label */
//   const label = document.createElement("span");
//   label.className = "label";
//   label.textContent = "Latest:";
//   track.appendChild(label);

  /* -----------------------------
     2. Use absolute path to search.json
  ----------------------------- */
  const searchJsonPath = './search.json';  // absolute path from site root

  fetch(searchJsonPath)
    .then(r => {
      if (!r.ok) throw new Error("search.json not found");
      return r.json();
    })
    .then(data => {

      /* Support both Quarto search.json formats */
      const items = data.items || data;

      /* Filter real articles only */
      const articles = items.filter(item =>
        item.title &&
        item.href &&
        !item.href.includes("about") &&
        !item.href.includes("index") &&
        !item.href.endsWith("/")
      );

      if (!articles.length) return;

      /* Function to append all headlines */
      function appendArticles() {
        articles.forEach(a => {
          const link = document.createElement("a");
          link.href = a.href;
          link.textContent = a.title;
          track.appendChild(link);
        });
      }

      /* Duplicate content for infinite looping */
      appendArticles();
      appendArticles();

      /* -----------------------------
         3. After content loads, compute track width
            and generate a matching animation speed.
      ----------------------------- */
      requestAnimationFrame(() => {
        const totalWidth = track.getBoundingClientRect().width;

        /* Create dynamic keyframes */
        const duration = totalWidth / 60;  // pixels per second

        const styleEl = document.createElement("style");
        styleEl.textContent = `
          @keyframes profitTimesScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-${totalWidth / 2}px); }
          }
          #profit-times-ticker-track {
            animation: profitTimesScroll ${duration}s linear infinite;
          }
        `;
        document.head.appendChild(styleEl);
      });
    })
    .catch(err => {
      console.error("Ticker failed:", err);
      container.style.display = "none";  // don't break the page
    });
});
</script>
